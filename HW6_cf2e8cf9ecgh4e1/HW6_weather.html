<!DOCTYPE html>
<html>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="utils.js"></script>
    <style>
        header {
            background-image: url(Images/banner.jpg);
            border: gray solid 1px;
            font-weight: lighter;
        }

        .container {
            display: grid;
            border: gray solid 1px;
            padding: 30px;
        }

        .address {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        #card {
            display: none;
        }

        #icon_temperture {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        #specific_info_grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr;
        }

        #humidity_img {
            height: 40px;
            width: 40px;
            content:url('./Images/humidity.png');
        }

        #pressure_img {
            height: 40px;
            width: 40px;
            content:url('./Images/pressure.png');
        }

        #wind_speed_img {
            height: 40px;
            width: 40px;
            content:url('./Images/wind_speed.png');
        }

        #visibility_img {
            height: 40px;
            width: 40px;
            content:url('./Images/visibility.png');
        }

        #cloud_cover_img {
            height: 40px;
            width: 40px;
            content:url('./Images/cloud_cover.png');
        }

        #uv_level_img {
            height: 40px;
            width: 40px;
            content:url('./Images/uv_level.png');
        }

        .weekly_weather_card_top {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            background-color: #587ab9;
        }

        #weekly_weather_card_container {
            display: none;
        }

        .weekly_weather_card {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
        }
        
    </style>
    <header>
        <h1>Weather Search</h1>
        <h2>Fill out the form to get
            weather info!</h2>
    </header>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <body>
        <div class="container">
            <div>
                Street
                <input type="text" name="street" id="street_input" required>
            </div>
                <div class="address">
                    <div>
                        <label for="psw">City</label>
                        <input type="text" name="city" id="city_input" required>
                    </div>
                    <div>
                        <label for="psw" name="state">State</label>
                        <!-- <input type="text" name="state" required> -->
                        <select multiple id="state_input" required>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District Of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>			
                    </div>
            </div>
            <hr/>
            <label>
                <span class="psw"> Want us to auto-detect your location? Check here</span>
                <input type="checkbox"  checked="checked" name="remember">
            </label>
            
            <div class="buttons">
                <button type="submit" onclick="sendAddress()">Submit</button>
                <script>

                    var HttpClient = function() {
                        this.get = function(aUrl, aCallback) {
                            var anHttpRequest = new XMLHttpRequest();
                            anHttpRequest.onreadystatechange = function() { 
                                if (anHttpRequest.readyState == 4 && anHttpRequest.status == 200)
                                    aCallback(anHttpRequest.responseText);
                            }
                            anHttpRequest.open( "GET", aUrl, true );            
                            anHttpRequest.send( null );
                        }
                    }

                    function sendAddress() {
                        var client = new HttpClient();
                        
                        client.get('http://127.0.0.1:5000/weekly_weather', function(response) {
                            var json_data = JSON.parse(response);

                            // weekly_weather_card.date.innerText = json_data["data"]["timelines"][0]["intervals"][0]["startTime"];
                            let elements = document.getElementsByClassName('weekly_weather_card');
                            document.querySelector(".weekly_weather_card .date").innerText = json_data["data"]["timelines"][0]["intervals"][0]["startTime"];
                            document.querySelector(".weekly_weather_card .status").innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["weatherCode"];
                            document.querySelector(".weekly_weather_card .temp_high").innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["temperatureMax"];
                            document.querySelector(".weekly_weather_card .temp_low").innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["temperatureMin"];
                            document.querySelector(".weekly_weather_card .wind_speed").innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["windSpeed"];
                            
                            for(i=0; i<json_data["data"]["timelines"][0]["intervals"].length; ++i) {
                                var board = document.createElement('div');
                                board.className = "weekly_weather_card";

                                var newEntry1 = document.createElement('div');
                                newEntry1.innerText = json_data["data"]["timelines"][0]["intervals"][i]["startTime"];
                                board.appendChild(newEntry1);

                                var newEntry2 = document.createElement('div');
                                newEntry2.innerText = json_data["data"]["timelines"][0]["intervals"][i]["values"]["weatherCode"];
                                board.appendChild(newEntry2);

                                var newEntry3 = document.createElement('div');
                                newEntry3.innerText = json_data["data"]["timelines"][0]["intervals"][i]["values"]["temperatureMax"];
                                board.appendChild(newEntry3);

                                var newEntry4 = document.createElement('div');
                                newEntry4.innerText = json_data["data"]["timelines"][0]["intervals"][i]["values"]["temperatureMin"];
                                board.appendChild(newEntry4);

                                var newEntry5 = document.createElement('div');
                                newEntry5.innerText = json_data["data"]["timelines"][0]["intervals"][i]["values"]["windSpeed"];
                                board.appendChild(newEntry5);

                                document.getElementById("weekly_weather_card_container").appendChild(board);

                                console.log(i);
                            }
                            
                            // ".cl1 .sl_price"
                            // console.log(elements.);
                            // elements.date.innerText = json_data["data"]["timelines"][0]["intervals"][0]["startTime"];
                            

                            $("#weekly_weather_card_container").css('display', 'block');
                        })

                        client.get('http://127.0.0.1:5000/current_weather', function(response) {
                            
                            var json_data = JSON.parse(response);
                            // var json_data = response;
                            // document.getElementById('address').value = response[0]['results'][0]['address_components'][3]['long_name'];
                            // $('#humiditiy_value').html("10");
                            console.log(json_data);
                            
                            // weather icon
                            var weather_icon_img_dir = "./Images/clear_night.svg";
                            var weather_icon_text = "clear";
                            
                            // TODO: Clear Sunny, Mostly Clear, Partly Cloudy <- differentiate day and night!!!
                            var is_sunset = false;

                            [weather_icon_img_dir, weather_icon_text] = weatherCodeMapper(json_data["data"]["timelines"][0]["intervals"][0]["values"]["weatherCode"], is_sunset);

                            $("#weather_code_img").attr("src",weather_icon_img_dir);
                            weather_code_text.innerText = weather_icon_text;

                            // console.log(typeof json_data["data"]["timelines"][0]["intervals"][0]["values"]["temperature"]);
                            current_temperture.innerText = Math.round(json_data["data"]["timelines"][0]["intervals"][0]["values"]["temperature"]) + "º"

                            // weather specific infos
                            humidity_value.innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["humidity"] + "%";
                            pressure_value.innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["pressureSeaLevel"] + "inHg";
                            wind_speed_value.innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["windSpeed"] + "mph";
                            visibility_value.innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["visibility"] + "mi";
                            cloud_cover_value.innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["cloudCover"] + "%";
                            uv_level_value.innerText = json_data["data"]["timelines"][0]["intervals"][0]["values"]["uvIndex"];
                            
                            $("#card").css('display', 'block');
                            // document.getElementById('card').style.display = 'block';
                        });
                        // var street = document.getElementById("street_input").value;
                        // var city = document.getElementById("city_input").value;
                        // var state = document.getElementById("state_input").value;

                        // console.log(street);
                        // console.log(city);
                        // console.log(state);

                        // axios.get('http://127.0.0.1:5000')
                        //     .then(response => {
                        //         console.log(response.data);
                        //     })
                        //     .catch(error => console.error(error));
                    }
                </script>
                <button type="clear">Clear</button>
            </div>
        </div>

        <div id="card">
            <div class="container">
                <div>
                    <h1 id="address">Los Angeles, California</h1>
                </div>
                <div id="icon_temperture">
                    <div>
                        <img id="weather_code_img" src="./Images/clear_day.svg" width="150" height="150">
                        <h3 id="weather_code_text">clear</h3>
                    </div>
                    <div>
                        <h1 id="current_temperture">000</h1>
                    </div>
                </div>
                <div id="specific_info_grid">
                    <div class="specific_infos">
                        <h6>humidity</h6>
                        <div id="humidity_img"></div>
                        <h6 id="humidity_value">000</h6>
                    </div>

                    <div class="specific_infos">
                        <h6>Pressure</h6>
                        <div id="pressure_img"></div>
                        <h6 id="pressure_value">000</h6>
                    </div>

                    <div class="specific_infos">
                        <h6>Wind Speed</h6>
                        <div id="wind_speed_img"></div>
                        <h6 id="wind_speed_value">000</h6>
                    </div>

                    <div class="specific_infos">
                        <h6>Visibility</h6>
                        <div id="visibility_img"></div>
                        <h6 id="visibility_value">000</h6>
                    </div>

                    <div class="specific_infos">
                        <h6>Cloud Cover</h6>
                        <div id="cloud_cover_img"></div>
                        <h6 id="cloud_cover_value">000</h6>
                    </div>

                    <div class="specific_infos">
                        <h6>UV Level</h6>
                        <div id="uv_level_img"></div>
                        <h6 id="uv_level_value">000</h6>
                    </div>
                </div>
            </div>
        </div>

        <div id="weekly_weather_card_container">
            <div class="weekly_weather_card_top">
                <div>Date</div>
                <div>Status</div>
                <div>Temp High</div>
                <div>Temp Low</div>
                <div>Wind Speed</div>
            </div>

            <div class="weekly_weather_card">
                <div class="date"></div>
                <div class="status"></div>
                <div class="temp_high"></div>
                <div class="temp_low"></div>
                <div class="wind_speed"></div>
            </div>
        </div>
    </body>
</html>